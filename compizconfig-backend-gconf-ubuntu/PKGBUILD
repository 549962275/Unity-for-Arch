# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=compizconfig-backend-gconf-ubuntu
_ubuntu_rel=0ubuntu4
pkgver=0.9.5.92.${_ubuntu_rel}
pkgrel=100
pkgdesc="GConf backend for Compiz - Ubuntu version"
url="http://www.compiz.org/"
license=('GPL' 'LGPL' 'MIT')
arch=('i686' 'x86_64')
depends=('gconf' 'libcompizconfig-ubuntu' 'glib2-ubuntu')
makedepends=('intltool' 'cmake' 'libtool' 'pkgconfig')
provides=('compizconfig-backend-gconf')
conflicts=('compizconfig-backend-gconf')
groups=('unity')
source=("https://launchpad.net/ubuntu/+archive/primary/+files/${pkgname%-*}_${pkgver%.*}.orig.tar.gz"
        "https://launchpad.net/ubuntu/+archive/primary/+files/${pkgname%-*}_${pkgver%.*}-${_ubuntu_rel}.debian.tar.gz")
sha512sums=('d03bd33ab21af915825a1f51dbc8411ce3edea5e485ce6f90a6f65cefeb3b1b949254ac93da655f1abb2ec4bc25010ba1c6858f62fa1a8510e05c0a938685f67'
            'ea98abc83d1e1caef2036459e09ea775c97a73cebdba314f29cd1ce96c238f8d4d3995afbc894bd3796444a75ba8aa366ac9cc654a6366dd13e7c898661bedac')

build() {
  cd "${pkgname%-*}-${pkgver%.*}"

  # Apply Ubuntu patches

  # Disable patches
    # Merged upstream
      sed -i '/01_add_transition_gconf.patch/d' "${srcdir}/debian/patches/series"

  for i in $(cat "${srcdir}/debian/patches/series" | grep -v '#'); do
    patch -Np1 -i "${srcdir}/debian/patches/${i}"
  done

  [[ -d build ]] || mkdir build
  cd build
  cmake .. \
    -DCOMPIZ_BUILD_WITH_RPATH=FALSE \
    -DCOMPIZ_PACKAGING_ENABLED=TRUE \
    -DCOMPIZ_PLUGIN_INSTALL_TYPE=package \
    -DCMAKE_BUILD_TYPE=RelWithDebInfo \
    -DCMAKE_INSTALL_PREFIX=/usr \
    -DCOMPIZ_DESTDIR="${pkgdir}"
  make ${MAKEFLAGS}
}

package() {
  cd "${srcdir}/${pkgname%-*}-${pkgver%.*}/build"
  make install
}
