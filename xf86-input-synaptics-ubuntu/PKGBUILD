# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=xf86-input-synaptics-ubuntu
_ubuntu_ver="~git20120223"
_ubuntu_rel=0ubuntu2
_actual_ver=1.5.99

# The AUR is sooo annoying...
pkgver=${_actual_ver}.git20120223.${_ubuntu_rel}

pkgrel=1
pkgdesc="Synaptics driver for notebook touchpads"
arch=('i686' 'x86_64')
license=('custom')
url="http://xorg.freedesktop.org/"
depends=('libxtst' 'xorg-server-ubuntu')
makedepends=('xorg-server-devel-ubuntu' 'libxi-ubuntu' 'libx11-ubuntu')
conflicts=('xorg-server<1.11.0')
replaces=('synaptics' 'xf86-input-synaptics')
provides=('synaptics' 'xf86-input-synaptics')
conflicts=('synaptics' 'xf86-input-synaptics')
groups=('xorg-drivers' 'xorg')
options=(!libtool)
backup=('etc/X11/xorg.conf.d/10-synaptics.conf')
source=("10-synaptics.conf"
        "https://launchpad.net/ubuntu/+archive/primary/+files/xserver-xorg-input-synaptics_${_actual_ver}${_ubuntu_ver}.orig.tar.gz"
        "https://launchpad.net/ubuntu/+archive/primary/+files/xserver-xorg-input-synaptics_${_actual_ver}${_ubuntu_ver}-${_ubuntu_rel}.diff.gz")
sha512sums=('3e78c3c77e58ca9de19fc97b9cc3d7d6d08a740bacf005d564de9193e60037a0262ed6b0841f2b3d98adb5ba60675f4856569978d5cb47c4ed2312e47fe6c085'
            '468a49e4e2222a18f7f367ab1f5554dd8ad64420045b00d952e3645ec59cc5eed876f4bcc7909762d543d9aad357671d19fce3955a82f90627d2954117f6b273'
            '8610112839dad065e205650a1bbd6bc523c37d0020a806e9c04d63b1bbd517b51a62d72acc27d8e73948a04275d4e86f98b28a275a2def6d858fcc91593f0f84')

build() {
  cd "${srcdir}/${pkgname%-*}-1.5.99"

  # Apply Ubuntu patches
  patch -Np1 -i "${srcdir}/xserver-xorg-input-synaptics_${_actual_ver}${_ubuntu_ver}-${_ubuntu_rel}.diff"
  for i in $(cat debian/patches/series | grep -v '#'); do
    patch -Np1 -i "debian/patches/${i}"
  done

  chmod +x autogen.sh
  ./autogen.sh --prefix=/usr
  make ${MAKEFLAGS}
}

package() {
  cd "${srcdir}/${pkgname%-*}-1.5.99"
  make DESTDIR="${pkgdir}" install
  install -dm755 "${pkgdir}/etc/X11/xorg.conf.d"
  install -m644 "${srcdir}/10-synaptics.conf" "${pkgdir}/etc/X11/xorg.conf.d/"
  install -dm755 "${pkgdir}/usr/share/licenses/${pkgname%-*}"
  install -m644 COPYING "${pkgdir}/usr/share/licenses/${pkgname%-*}/"

  #rm -rf "${pkgdir}/usr/share/X11"
}
