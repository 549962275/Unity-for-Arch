# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
# Original Maintainer: György Balló <ballogy@freestart.hu>
# Contributor: thn81 <root@scrat>

pkgname=zeitgeist-datahub
_ubuntu_rel=1ubuntu1
pkgver=0.8.2.${_ubuntu_rel}
pkgrel=100
pkgdesc="The datahub provides passive plugins which insert events into Zeitgeist"
arch=('i686' 'x86_64')
url="https://launchpad.net/zeitgeist-datahub"
license=('GPL')
depends=('libzeitgeist' 'gtk2-ubuntu')
makedepends=('intltool' 'vala')
groups=('unity')
source=("http://launchpad.net/${pkgname}/${pkgver%.*.*}/${pkgver%.*}/+download/${pkgname}-${pkgver%.*}.tar.gz"
        "https://launchpad.net/ubuntu/+archive/primary/+files/${pkgname}_${pkgver%.*}-${_ubuntu_rel}.debian.tar.gz")
sha512sums=('277963060a45172288caa21a06516097be20cc545b96981b9ae68095826bba6e97128c9de2b2535e2cb564867e20b8daf48a8a4d128d7c7a7eafe7ebad8be416'
            '376337754aace0f9cee22448c8b8444c6a29fdc4c1f2a8238587c20fe6c43283f4071a1a4f11f409fc22951883bfd89463ea79c3d78af7e7903b65977fa7113e')

build() {
  cd "${srcdir}/${pkgname}-${pkgver%.*}"

  # Apply Ubuntu patches
  patch -Np1 -i "${srcdir}/debian/patches/nodisplay_autostart.patch"
  patch -Np1 -i "${srcdir}/debian/patches/add_datahub_autostart_delay.patch"

  ./configure --prefix=/usr --sysconfdir=/etc
  make ${MAKEFLAGS}
}

package() {
  cd "${srcdir}/${pkgname}-${pkgver%.*}"

  make DESTDIR="${pkgdir}/" install
}
