# Maintainer: Xiao-Long Chen <chenxiaolong@cxl.epac.to>

pkgname=ccsm-ubuntu
_ubuntu_rel=0ubuntu1
pkgver=0.9.5.92.${_ubuntu_rel}
pkgrel=100
pkgdesc="Compizconfig Settings Manager in Python - Ubuntu version"
arch=('any')
url="http://compiz.org"
license=('GPL')
provides=('ccsm')
conflicts=('ccsm')
groups=('unity')
depends=('compiz-core-ubuntu' 'compizconfig-python-ubuntu' 'pygtk')
install="ccsm-ubuntu.install"
source=("https://launchpad.net/ubuntu/+archive/primary/+files/compizconfig-settings-manager_${pkgver%.*}.orig.tar.gz"
        "https://launchpad.net/ubuntu/+archive/primary/+files/compizconfig-settings-manager_${pkgver%.*}-${_ubuntu_rel}.diff.gz")
sha512sums=('541feec8384540ca011190aceb9596d558ff4b71f03e64b7e8800adcdf942d9a47fe53859820ecad74f7b80d0914c4d7be5bd4499db8551d554701a3edf93802'
            '678e762edbff4b34511c0e2612f5f45604ea62dca0d277bf13348bb6e32a77a05cbc7e9c8b75f31ea66c79da21e6dec11adb78070150416af3fc11b149af1721')

build() {
  cd "${srcdir}/${pkgname%-*}-${pkgver%.*}"

  # Apply Ubuntu patches
  patch -Np1 -i "${srcdir}/compizconfig-settings-manager_${pkgver%.*}-${_ubuntu_rel}.diff"

  sed -i 's|^\(#!.*python\)$|\12|g' ccsm
  python2 setup.py build --prefix="/usr"
}

package() {
  cd "${srcdir}/${pkgname%-*}-${pkgver%.*}"
  python2 setup.py install --prefix="/usr" --root="${pkgdir}"
  install -dm755 "${pkgdir}/usr/share/applications/"
  install -m644 "${pkgname%-*}.desktop" "${pkgdir}/usr/share/applications/"
}
